<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>todo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
</head>

<body class="bg-light">
  <div class="container-sm p-4">
    <div class="row justify-content-center">
      <div id="app" class="col col-lg-6">
        <form @submit.prevent="addTodo">
          <div class="input-group mb-3">
            <input class="form-control" placeholder="Enter new todo" v-model="newTodo">
            <button class="btn btn-outline-secondary">Add todo!</button>
          </div>
        </form>
        <ul class="list-group">
          <todo v-for="(todo, index) in todos" v-model="todo.content" :key="todo.id" @delete="todos.splice(index, 1)">
          </todo>
        </ul>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous">
  </script>
  <script src="https://unpkg.com/vue@next"></script>
  <script>
    const app = Vue.createApp({
      data() {
        return {
          todos: [{
            id: 0,
            content: 'sample todo'
          }],
          nextId: 1,
          newTodo: ''
        }
      },
      created() {
        const localData = JSON.parse(localStorage.getItem('todos'))
        if (localData && localData.length) {
          this.todos = localData
          this.nextId = this.todos[this.todos.length - 1].id + 1
        }
      },
      updated() {
        localStorage.setItem('todos', JSON.stringify(this.todos))
      },
      methods: {
        addTodo() {
          this.todos.push({
            id: this.nextId++,
            content: this.newTodo
          })
          this.newTodo = ''
        }
      }
    })

    app.component('todo', {
      data() {
        return {
          isDisabled: true
        }
      },
      methods: {
        toggleEditable() {
          this.isDisabled = !this.isDisabled
        }
      },
      computed: {
        editMessage() {
          return this.isDisabled ? 'Edit' : 'Done'
        }
      },
      props: ['modelValue'],
      template: `
    <li class="list-group-item d-flex justify-content-between">
      <input
        :value="modelValue"
        @input="$emit('update:modelValue', $event.target.value)"
        :disabled="isDisabled"
        :class="['bg-white flex-grow-1 me-2', isDisabled ? 'border-0' : 'border border-primary border-2 rounded']"
      >
      <div>
        <button :class="['btn', {'btn-success': !isDisabled}]" @click="toggleEditable">{{ editMessage }}</button>
        <button class="btn btn-light ms-2" @click="$emit('delete')">Delete!</button>
      </div>
    </li>
  `
    })

    app.mount('#app')
  </script>
</body>

</html>
